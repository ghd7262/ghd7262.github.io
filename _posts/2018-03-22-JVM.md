---
layout: post
title: JDK/JRE/JVM과 자바의 메모리 구조
category: Java Study
tags: JVM Java-Memory-Structure
---


#### JVM/JRE/JDK
먼저 JVM (Java Virtual Machine)이란, 자바 바이트코드 java bytecode를 실행하는 가상기계이다. 이 가상기계는 자바 프로그램을 실행할 때 컴퓨터 자원을 할당 받아서 프로그램이 돌아갈 수 있도록 해준다. JVM은 java.class 소스코드를 읽지 못하고 오로지 자바 컴파일러가 컴파일 한 java bytecode만 읽을 수 있다. 자바는 Write Once Run Anywhere라는 모토를 기반으로 만들어졌는데, JVM이 이 모토의 중심에 있다. 어떠한 운영체제이든 간에 JVM만 설치돼 있으면 자바 프로그램을 돌릴 수 있다.

JRE (Java Runtime Environment)는 JVM을 포함하고 자바 프로그램을 만들고 실행 할 때 필요한 환경, ex) 라이브러리, 자바 실행기 java.exe 를 제공한다. JVM의 운영체제 같은 역할을 한다.

JDK (Java Development kit)는 JRE와 소스파일 컴파일러 javac.exe.를 제공한다.

---

#### 메모리 구조
어떤 프로그램이 시작될 때 컴터에는 크게 두 분류의 메모리가 준비된다:

1. 코드 실행 영역
2. **데이터 저장 영역**

여기서 자바 개발자로써 중요한 부분은 데이터 저장 영역이다. 이 영역은 또 다시 세 분류의 영역으로 나뉜다: 

1. **스태틱 Static 영역**
2. **스택 Stack 영역**
3. **힙 Heap 영역**

스태틱 영역은 클래스와 그 클래스의 전역변수가 머무는 영역이다. 여러 메서드들이 접근할 수 있다는 속성을 가진다. 여러 (멀티쓰레드 Multi-Thread) 메서드들이 접근할 수 있는 만큼 전역변수의 사용을 자제해야 하고 설계를 할 때 조심해야 한다. 왜냐하면 여러 메서드가 접근해서 상태 값을 바꾼다면 특정 메서드가 원래 써야할 값이랑 전혀 다른 상태 값을 가져가서 쓸 수 있기 때문이다.

스택 영역은 메서드들이 머무는 곳이다. 메서드가 호출될 때마다 '스택 프래임' Stack Frame이라는 일종의 컨테이너 같은 게 생겨서 인자로 '복사'해서 주지 않는 한메서드 안의 지역변수를 접근할 수 없다. 메서드가 종료 된다는 건 스택프래임과 그 안에 지역변수들의 소멸을 뜻한다. 그렇다면 메서드 내에서 다른 메서드를 호출하면 어떻게 될까? '스택'이라는 단어를 보면 알 수 있다. 말 그대로 호출한 메서드 위에 호출된 메서드의 스택프래임이 쌓이게 된다. 그래서 새로 생성된 메서드의 닫는 중괄호가 실행될 때까지 그 전 스택은 실행이 멈춘 채 그 위에 스택이 종료될 때까지 기다린다. While 문과 재귀호출은 둘 다 반복적으로 무엇인가 수행한다는 점에서 같지만 while문은 *메서드 내에서* while의 닫는 중괄호를 만날 때 선언한 값이 true면 다시 처음으로 간다. 하지만 재귀호출은 계속해서 새로운 스택을 쌓아 올리기 때문에 조건 없는 재귀호출은 결국 Stack Overflow를 일으킨다.

힙 영역은 객체 Object가 머무는 공간이다. 어떤 클래스의 인스턴스를 생성하면 이 영역에 저장된다. (힙 영역과 객체에 대해서는 나중에 구체적으로 학습 예정)

---

**메로리가 쓰이는 순서:**

1. 프로그램이 시작되면 JRE는 JVM을 구동시키고 JVM은 컴퓨터로부터 자원을 할당 받는다. 
2. 스태틱 영역에 자바의 가장 기본 패키지인 java.lang을 올려 놓는다.
3. 클래스 영역에 클래스와 전역변수를 올려 놓는다.
4. main을 찾아서 스택프래임을 만들고 main의 지역변수, 메인메서드가 프래임에 가두어진 형태로 스택영역에 올려 놓는다.
5. main에서 호출된 메서드들, 그 메서드들이 호출한 메서드들이 위에 설명대로 올려진다.
6. 모든 메서드들이 종료되어 스택프래임이 사라지고 메인 메서드가 끝나는 순간 스택영역은 비워지며 프로그램도 종료된다.